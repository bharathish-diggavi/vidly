(this.webpackJsonpvidly=this.webpackJsonpvidly||[]).push([[0],{76:function(e,t,n){},80:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n.n(r),s=n(26),c=n.n(s),o=n(3),i=n(14),l=n(4),u=n(20),d=n(2),b=n.n(d),j=n(6),p=n(17),h=n(18),m=n(21),v=n(19),O=n(8),f=n.n(O),g=n(42),x=n(16),k=n.n(x);var y={init:function(){},logError:function(e){console.log(e)}};k.a.defaults.baseURL="https://blooming-plains-24038.herokuapp.com/api/",k.a.interceptors.response.use(null,(function(e){return e.response&&e.response.status>=400&&e.response.status<500||(console.log("interceptor called",e),u.b.error("something went wrong"),y.logError(e)),Promise.reject(e)}));var S={get:k.a.get,post:k.a.post,put:k.a.put,patch:k.a.patch,delete:k.a.delete,setJwtToken:function(e){k.a.defaults.headers.common["x-auth-token"]=e}},w="/auth",C="token";function N(){return(N=Object(j.a)(b.a.mark((function e(t,n){var r,a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.post(w,{email:t,password:n});case 2:r=e.sent,a=r.data,localStorage.setItem(C,a);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(){return(_=Object(j.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:localStorage.removeItem(C);case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(){return localStorage.getItem(C)}S.setJwtToken(I());var R={login:function(e,t){return N.apply(this,arguments)},logout:function(){return _.apply(this,arguments)},getCurrentUser:function(){try{var e=localStorage.getItem(C);return Object(g.a)(e)}catch(t){return null}},loginWithJwt:function(e){localStorage.setItem(C,e)},getJwtToken:I},P=n(24),T=n(22),F=n(0),A=function(e){var t=e.name,n=e.label,r=e.error,a=Object(T.a)(e,["name","label","error"]);return Object(F.jsxs)("div",{className:"form-group",children:[Object(F.jsx)("label",{htmlFor:t,children:n}),Object(F.jsx)("input",Object(o.a)(Object(o.a)({},a),{},{name:t,className:"form-control"})),Object(F.jsx)("div",{className:"aler alert-danger",children:r})]})},E=function(e){var t=e.name,n=e.label,r=e.options,a=e.error,s=Object(T.a)(e,["name","label","options","error"]);return Object(F.jsxs)("div",{className:"form-group",children:[Object(F.jsx)("label",{htmlFor:t,children:n}),Object(F.jsxs)("select",Object(o.a)(Object(o.a)({},s),{},{name:t,className:"form-control",children:[Object(F.jsx)("option",{value:""}),r.map((function(e){return Object(F.jsx)("option",{value:e._id,children:e.name},e._id)}))]})),Object(F.jsx)("div",{className:"aler alert-danger",children:a})]})},L=function(e){var t=e.value,n=e.onChange,r=Object(T.a)(e,["value","onChange"]);return Object(F.jsx)("div",{className:"form-group",children:Object(F.jsx)("input",Object(o.a)({className:"form-control",value:t,onChange:function(e){return n(e.currentTarget.value)}},r))})},U=n(13),D=n.n(U),M=function(e){Object(m.a)(n,e);var t=Object(v.a)(n);function n(){var e;Object(p.a)(this,n);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).validate=function(){var t=f.a.validate(e.state.data,e.schema,{abortEarly:!1,allowUnknown:!0}).error;if(!t)return null;var n={};return t.details.forEach((function(e){return n[e.path[0]]=e.message})),0===Object.keys(n)?null:n},e.validateProperty=function(t){var n=t.name,r=t.value,a=Object(P.a)({},n,r),s=Object(P.a)({},n,D.a.get(e.schema,n)),c=f.a.validate(a,s).error;return c?c.details[0].message:null},e.handleChange=function(t){var n=t.currentTarget,r=Object(o.a)({},e.state.errors),a=e.validateProperty(n);a?r[n.name]=a:delete r[n.name];var s=Object(o.a)({},e.state.data);s[n.name]=n.value,e.setState({data:s,errors:r})},e.handleSubmit=function(t){t.preventDefault();var n=e.validate(e.state.data);e.setState(n||{}),n||e.doSubmit()},e}return Object(h.a)(n,[{key:"renderInputFiels",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"text",a=this.state,s=a.data,c=a.errors;return Object(F.jsx)(A,{name:e,type:r,onChange:this.handleChange,label:t,value:D.a.get(s,e),autoFocus:n,error:c[e]})}},{key:"renderSelect",value:function(e,t,n){var r=this.state,a=r.data,s=r.errors;return Object(F.jsx)(E,{name:e,onChange:this.handleChange,label:t,value:a[e],error:s[e],options:n})}},{key:"renderSubmitButton",value:function(e){return Object(F.jsx)("button",{disabled:this.validate(this.state.data),className:"btn btn-primary",children:e})}}]),n}(r.Component),q=function(e){Object(m.a)(n,e);var t=Object(v.a)(n);function n(){var e;Object(p.a)(this,n);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).state={data:{username:"",password:""},errors:{}},e.schema={username:f.a.string().required().label("Username"),password:f.a.string().required().label("Password")},e}return Object(h.a)(n,[{key:"doSubmit",value:function(){var e=Object(j.a)(b.a.mark((function e(){var t,n,r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=this.state.data,e.next=4,R.login(t.username,t.password);case 4:n=this.props.location.state,window.location=n?n.from:"/",e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.log("inside ex"),e.t0.response&&400===e.t0.response.status&&(console.log(e.t0.response),(r=Object(o.a)({},this.state.errors)).username=e.t0.response.data,this.setState({errors:r}),u.b.error(e.t0.response.data));case 12:case"end":return e.stop()}}),e,this,[[0,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return R.getCurrentUser()?Object(F.jsx)(l.a,{to:"/"}):Object(F.jsx)("div",{children:Object(F.jsxs)("form",{onSubmit:this.handleSubmit,children:[Object(F.jsx)("h1",{children:"Login"}),this.renderInputFiels("username","Username",!0),this.renderInputFiels("password","Password",!1,"password"),this.renderSubmitButton("Login")]})})}}]),n}(M),B=n(32),J=n(7),G="/movies";function W(e){return"".concat(G,"/").concat(e)}function V(e){return H.apply(this,arguments)}function H(){return(H=Object(j.a)(b.a.mark((function e(t){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t._id?(delete(n=Object(o.a)({},t))._id,S.put(W(t._id),n)):S.post(G,t);case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var K=function(e){var t=e.isLiked,n=e.onToggleLike;return Object(F.jsx)("i",{className:"fa fa-heart"+(t?"":"-o"),"aria-hidden":"true",onClick:n,style:{cursor:"pointer"}})},z=function(e){var t=e.data,n=e.columns,r=function(e,t){return e._id+(t.path||t.key)};return Object(F.jsx)("tbody",{children:t.map((function(e){return Object(F.jsx)("tr",{children:n.map((function(t){return t.content?Object(F.jsx)("td",{children:t.content(e)},r(e,t)):Object(F.jsx)("td",{children:D.a.get(e,t.path)},r(e,t))}))},e._id)}))})},Q=function(e,t){return{path:t,order:e&&"desc"===e.order?"asc":"desc"}},X=function(e){var t=e.columns,n=e.sortColum,r=e.onSort,a=function(e){return e.path!==n.path?null:"asc"===n.order?Object(F.jsx)("i",{className:"fa fa-sort-asc","aria-hidden":"true"}):Object(F.jsx)("i",{className:"fa fa-sort-desc","aria-hidden":"true"})};return Object(F.jsx)("thead",{children:Object(F.jsx)("tr",{children:t.map((function(e){return Object(F.jsxs)("th",{style:{cursor:"pointer"},onClick:function(){return r(Q(n,e.path))},children:[e.label," ",a(e)]},e.path||e.key)}))})})},Y=function(e){var t=e.columns,n=e.sortedColumn,r=e.onSort,a=e.tableData;return Object(F.jsx)(F.Fragment,{children:Object(F.jsxs)("table",{className:"table",children:[Object(F.jsx)(X,{columns:t,sortColum:n,onSort:r}),Object(F.jsx)(z,{data:a,columns:t})]})})},Z=function(e){var t=e.movies,n=e.onLike,r=e.onDelete,a=e.onSort,s=e.sortedColumn,c=[{path:"title",label:"Title",content:function(e){return R.getCurrentUser()?Object(F.jsx)(J.b,{to:"/movies/".concat(e._id),data:e,children:e.title}):e.title}},{path:"genre.name",label:"Genre"},{path:"numberInStock",label:"Stock"},{path:"dailyRentalRate",label:"Rate"},{key:"like",content:function(e){return R.getCurrentUser()&&Object(F.jsx)(K,{isLiked:e.liked,onToggleLike:function(){return n(e)}})}},{key:"delete",content:function(e){return R.getCurrentUser()&&R.getCurrentUser().isAdmin&&Object(F.jsx)("button",{className:"btn btn-danger",onClick:function(){return r(e)},children:"Delete"})}}];return Object(F.jsx)(Y,{columns:c,sortedColumn:s,onSort:a,tableData:t})},$=function(e){var t=e.pageSize,n=e.totalCount,r=e.onPageClick,a=e.currentPage,s=Math.ceil(n/t);return 0===s?null:Object(F.jsx)(F.Fragment,{children:Object(F.jsx)("div",{children:Object(F.jsx)("nav",{"aria-label":"Page navigation example",children:Object(F.jsx)("ul",{className:"pagination",children:D.a.range(1,s+1).map((function(e){return Object(F.jsx)("li",{className:"page-item "+(e===a?"active":""),children:Object(F.jsx)("a",{className:"page-link",onClick:function(){return r(e)},children:e})},e)}))})})})})},ee=function(e,t,n){var r=(n-1)*t,a=n*t;return D.a.slice(e,r,a)},te=function(e){var t=e.items,n=e.selectedItem,r=e.textProperty,a=e.valueProperty,s=e.onItemSelect;return Object(F.jsx)("div",{children:Object(F.jsx)("ul",{className:"list-group",children:t.map((function(e){return Object(F.jsx)("li",{className:"list-group-item "+(n&&n._id===e._id?"active":""),onClick:function(){return s(e)},style:{cursor:"pointer"},children:e[r]},e[a]?e[a]:"default")}))})})};te.defaultProps={textProperty:"name",valueProperty:"_id"};var ne=te,re="/genres";function ae(){return S.get(re)}var se=function(e){var t=e.user,n=Object(r.useState)(),a=Object(i.a)(n,2),s=a[0],c=a[1],l=Object(r.useState)(4),d=Object(i.a)(l,2),p=d[0],h=(d[1],Object(r.useState)(1)),m=Object(i.a)(h,2),v=m[0],O=m[1],f=Object(r.useState)([]),g=Object(i.a)(f,2),x=g[0],k=g[1],y=Object(r.useState)(""),w=Object(i.a)(y,2),C=w[0],N=w[1],_=Object(r.useState)({path:"title",order:"asc"}),I=Object(i.a)(_,2),R=I[0],P=I[1],T=Object(r.useState)(""),A=Object(i.a)(T,2),E=A[0],U=A[1];Object(r.useEffect)(Object(j.a)(b.a.mark((function e(){var t,n,r,a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ae();case 2:return t=e.sent,n=t.data,e.next=6,S.get(G);case 6:r=e.sent,a=r.data,k([{name:"All Genres"}].concat(Object(B.a)(n))),c(a);case 10:case"end":return e.stop()}}),e)}))),[]);var M=function(){var e=Object(j.a)(b.a.mark((function e(t){var n,r,a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(n=s).filter((function(e){return e._id!==t._id})),c(r),e.prev=3,console.log(t),e.next=7,o=t._id,S.delete(W(o));case 7:a=e.sent,console.log(a),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(3),e.t0.response&&404===e.t0.response.status&&u.b.error("Couldn't find movie. It may have been deleted already"),c(n);case 15:case"end":return e.stop()}var o}),e,null,[[3,11]])})));return function(t){return e.apply(this,arguments)}}(),q=function(){var e=C&&C._id?s.filter((function(e){return e.genre._id===C._id})):s,t=D.a.orderBy(e,[R.path],[R.order]).filter((function(e){return e.title.toLowerCase().includes(E.toLowerCase())}));return{movieCount:t.length,moviesToDisplay:ee(t,p,v)}}(),V=q.movieCount,H=q.moviesToDisplay;return Object(F.jsxs)(F.Fragment,{children:[Object(F.jsxs)("div",{className:"movies__container row",children:[Object(F.jsx)("div",{className:"sidebar__container col-3",children:Object(F.jsx)(ne,{items:x,selectedItem:C,onItemSelect:function(e){N(e),O(1),U("")}})}),Object(F.jsxs)("div",{className:"movies__Table__container col",children:[Object(F.jsxs)("h2",{children:["There are ",V," available"]}),t&&Object(F.jsx)(J.b,{to:"/movies/new",children:Object(F.jsx)("button",{className:"btn btn-primary",style:{padding:".5em 2em",margin:".5em"},children:"New"})}),Object(F.jsx)(L,{value:E,placeholder:"Search...",onChange:function(e){N(""),U(e),O(1)}}),Object(F.jsx)(Z,{movies:H,onLike:function(e){c(Object(B.a)(s).map((function(t){return t._id===e._id?Object(o.a)(Object(o.a)({},t),{},{liked:!e.liked}):t})))},onDelete:M,onSort:function(e){P(e)},sortedColumn:R})]})]}),Object(F.jsx)($,{totalCount:V,pageSize:p,onPageClick:function(e){O(e)},currentPage:v})]})},ce=function(){return Object(F.jsx)("div",{children:Object(F.jsx)("h1",{children:"Not Found"})})},oe=function(){return Object(F.jsx)("div",{children:Object(F.jsx)("h1",{children:"Customers"})})},ie=function(){return Object(F.jsx)("div",{children:Object(F.jsx)("h1",{children:"Rentals"})})},le=function(e){var t=e.user;return Object(F.jsxs)("nav",{className:"navbar navbar-expand-lg navbar-light bg-light",children:[Object(F.jsx)(J.b,{className:"navbar-brand",to:"/",children:"Vidly"}),Object(F.jsx)("button",{className:"navbar-toggler",type:"button","data-toggle":"collapse","data-target":"#navbarNavAltMarkup","aria-controls":"navbarNavAltMarkup","aria-expanded":"false","aria-label":"Toggle navigation",children:Object(F.jsx)("span",{className:"navbar-toggler-icon"})}),Object(F.jsx)("div",{className:"collapse navbar-collapse",id:"navbarNavAltMarkup",children:Object(F.jsxs)("div",{className:"navbar-nav",children:[t&&Object(F.jsxs)(F.Fragment,{children:[Object(F.jsx)(J.c,{className:"nav-item nav-link",to:"/movies",children:"Movies"}),Object(F.jsx)(J.c,{className:"nav-item nav-link",to:"/customers",children:"Customers"}),Object(F.jsx)(J.c,{className:"nav-item nav-link",to:"/rentals",children:"Rentals"})]}),!t&&Object(F.jsxs)(F.Fragment,{children:[Object(F.jsx)(J.c,{className:"nav-item nav-link",to:"/login",children:"Login"}),Object(F.jsx)(J.c,{className:"nav-item nav-link",to:"/register",children:"Register"})]}),t&&Object(F.jsxs)(F.Fragment,{children:[Object(F.jsx)(J.c,{className:"nav-item nav-link",to:"/profile",children:t.name}),Object(F.jsx)(J.c,{className:"nav-item nav-link",to:"/logout",children:"Logout"})]})]})})]})},ue=function(e){Object(m.a)(n,e);var t=Object(v.a)(n);function n(){var e;Object(p.a)(this,n);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).state={data:{title:"",genreId:"",numberInStock:"",dailyRentalRate:""},genres:[],errors:{}},e.schema={_id:f.a.string(),title:f.a.string().required().label("Title"),genreId:f.a.string().required().label("Genre"),numberInStock:f.a.number().required().min(0).max(100).label("Number In Stock"),dailyRentalRate:f.a.number().required().min(0).max(10).label("Daily Rental Rate")},e.doSubmit=Object(j.a)(b.a.mark((function t(){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,V(e.state.data);case 2:e.props.history.replace("/movies");case 3:case"end":return t.stop()}}),t)}))),e}return Object(h.a)(n,[{key:"componentDidMount",value:function(){var e=Object(j.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.populateGenres();case 2:return e.next=4,this.populateMovies();case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"populateMovies",value:function(){var e=Object(j.a)(b.a.mark((function e(){var t,n,r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(t=this.props.match.params.id)||"new"!==t.toLowerCase()){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,a=t,S.get(W(a));case 6:n=e.sent,r=n.data,this.setState({data:this.mapToViewModel(r)}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),e.t0.response&&404===e.t0.response.status&&this.props.history.replace("/not-found");case 14:case"end":return e.stop()}var a}),e,this,[[0,11]])})));return function(){return e.apply(this,arguments)}}()},{key:"populateGenres",value:function(){var e=Object(j.a)(b.a.mark((function e(){var t,n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ae();case 2:t=e.sent,n=t.data,this.setState({genres:n});case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"mapToViewModel",value:function(e){var t=e._id,n=e.title,r=e.genre,a=e.numberInStock,s=e.dailyRentalRate;return{_id:t,title:n,genreId:r._id,numberInStock:a,dailyRentalRate:s}}},{key:"render",value:function(){return Object(F.jsx)("div",{children:Object(F.jsxs)("form",{onSubmit:this.handleSubmit,children:[Object(F.jsx)("h1",{children:"Movie"}),this.renderInputFiels("title","Title",!0),this.renderSelect("genreId","Genere",this.state.genres),this.renderInputFiels("numberInStock","Number In Stock"),this.renderInputFiels("dailyRentalRate","Rate"),this.renderSubmitButton("Save")]})})}}]),n}(M),de="/users";var be=function(e){Object(m.a)(n,e);var t=Object(v.a)(n);function n(){var e;Object(p.a)(this,n);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).state={data:{username:"",password:"",name:""},errors:{}},e.schema={username:f.a.string().required().label("Username").email(),password:f.a.string().required().label("Password").min(5),name:f.a.string().required().label("Name").min(3)},e}return Object(h.a)(n,[{key:"doSubmit",value:function(){var e=Object(j.a)(b.a.mark((function e(){var t,n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r=this.state.data,S.post(de,{email:r.username,password:r.password,name:r.name});case 3:t=e.sent,R.loginWithJwt(t.headers["x-auth-token"]),window.location="/",e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),e.t0.response&&400===e.t0.response.status&&((n=Object(o.a)({},this.state.errors)).username=e.t0.response.data,this.setState({errors:n}));case 11:case"end":return e.stop()}var r}),e,this,[[0,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return Object(F.jsx)("div",{children:Object(F.jsxs)("form",{onSubmit:this.handleSubmit,children:[Object(F.jsx)("h1",{children:"Registration"}),this.renderInputFiels("username","Username",!0),this.renderInputFiels("password","Password",!1,"password"),this.renderInputFiels("name","Name"),this.renderSubmitButton("Register")]})})}}]),n}(M),je=function(){return Object(r.useEffect)((function(){R.logout(),window.location="/"}),[]),null},pe=(n(76),n(77),function(e){var t=e.component,n=e.render,r=Object(T.a)(e,["component","render"]);return Object(F.jsx)(l.b,Object(o.a)(Object(o.a)({},r),{},{render:function(e){return R.getCurrentUser()?t?Object(F.jsx)(t,Object(o.a)({},e)):n(e):Object(F.jsx)(l.a,{to:{pathname:"/login",state:{from:e.location.pathname}}})}}))}),he=function(){var e=Object(r.useState)(),t=Object(i.a)(e,2),n=t[0],a=t[1];return Object(r.useEffect)((function(){a(R.getCurrentUser())}),[]),Object(F.jsxs)(F.Fragment,{children:[Object(F.jsx)(u.a,{}),Object(F.jsx)(le,{user:n}),Object(F.jsx)("main",{className:"App container",children:Object(F.jsxs)(l.d,{children:[Object(F.jsx)(l.b,{path:"/login",component:q}),Object(F.jsx)(l.b,{path:"/logout",component:je}),Object(F.jsx)(pe,{path:"/movies/:id",component:ue}),Object(F.jsx)(l.b,{path:"/movies",render:function(e){return Object(F.jsx)(se,Object(o.a)(Object(o.a)({},e),{},{user:n}))}}),Object(F.jsx)(l.b,{path:"/customers",component:oe}),Object(F.jsx)(l.b,{path:"/rentals",component:ie}),Object(F.jsx)(l.b,{path:"/register",component:be}),Object(F.jsx)(l.b,{path:"/not-found",component:ce}),Object(F.jsx)(l.a,{from:"/",to:"/movies",exact:!0}),Object(F.jsx)(l.a,{to:"/not-found"})]})})]})},me=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,81)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,s=t.getLCP,c=t.getTTFB;n(e),r(e),a(e),s(e),c(e)}))};n(78),n(79);console.log("SUPERMAN",Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_URL:"https://blooming-plains-24038.herokuapp.com/api/"}).REACT_APP_NAME),c.a.render(Object(F.jsx)(J.a,{children:Object(F.jsx)(a.a.StrictMode,{children:Object(F.jsx)(he,{})})}),document.getElementById("root")),me()}},[[80,1,2]]]);
//# sourceMappingURL=main.f5e19351.chunk.js.map